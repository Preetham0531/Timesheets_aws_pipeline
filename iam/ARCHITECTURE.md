# IAM Roles System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AWS LAMBDA FUNCTION                             â”‚
â”‚                       IAM Roles Management API                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ENTRY POINT LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ lambda_function.py                                                â”‚  â”‚
â”‚  â”‚  â€¢ Receives HTTP event from API Gateway                          â”‚  â”‚
â”‚  â”‚  â€¢ Extracts HTTP method & query parameters                       â”‚  â”‚
â”‚  â”‚  â€¢ Validates caller identity                                     â”‚  â”‚
â”‚  â”‚  â€¢ Routes to appropriate handler                                 â”‚  â”‚
â”‚  â”‚  â€¢ Returns formatted HTTP response                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          HANDLERS LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ handlers/role_handler.py                                          â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  handle_options_request()     â†’ CORS preflight                   â”‚  â”‚
â”‚  â”‚  handle_post_request()        â†’ Create role                      â”‚  â”‚
â”‚  â”‚  handle_get_request()         â†’ Retrieve role(s)                 â”‚  â”‚
â”‚  â”‚  handle_put_request()         â†’ Update role / user override      â”‚  â”‚
â”‚  â”‚  handle_delete_request()      â†’ Delete role                      â”‚  â”‚
â”‚  â”‚  extract_caller_identity()    â†’ Auth validation                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SERVICES LAYER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ services/                                                         â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  role_creation_service.py                                        â”‚  â”‚
â”‚  â”‚    â€¢ Validate permissions (IAM.create)                           â”‚  â”‚
â”‚  â”‚    â€¢ Parse & normalize policies                                  â”‚  â”‚
â”‚  â”‚    â€¢ Check for conflicts                                         â”‚  â”‚
â”‚  â”‚    â€¢ Generate IDs & store in DB                                  â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  role_retrieval_service.py                                       â”‚  â”‚
â”‚  â”‚    â€¢ Query policy engine for allowed IDs                         â”‚  â”‚
â”‚  â”‚    â€¢ Fetch from database                                         â”‚  â”‚
â”‚  â”‚    â€¢ Filter based on permissions                                 â”‚  â”‚
â”‚  â”‚    â€¢ Format responses                                            â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  role_update_service.py                                          â”‚  â”‚
â”‚  â”‚    â€¢ Validate update permissions                                 â”‚  â”‚
â”‚  â”‚    â€¢ Merge policy changes                                        â”‚  â”‚
â”‚  â”‚    â€¢ Update database atomically                                  â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  role_deletion_service.py                                        â”‚  â”‚
â”‚  â”‚    â€¢ Check delete permissions                                    â”‚  â”‚
â”‚  â”‚    â€¢ Soft delete (status change)                                 â”‚  â”‚
â”‚  â”‚    â€¢ Hard delete (with cascade)                                  â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  user_customization_service.py                                   â”‚  â”‚
â”‚  â”‚    â€¢ Validate user & base role                                   â”‚  â”‚
â”‚  â”‚    â€¢ Process module overrides                                    â”‚  â”‚
â”‚  â”‚    â€¢ Store in UserGrants table                                   â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  user_role_view_service.py                                       â”‚  â”‚
â”‚  â”‚    â€¢ Fetch base role + overrides                                 â”‚  â”‚
â”‚  â”‚    â€¢ Merge policies intelligently                                â”‚  â”‚
â”‚  â”‚    â€¢ Return unified view                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                              â”‚
                     â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MODELS LAYER                â”‚  â”‚   CROSS-CUTTING CONCERNS        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ models/                    â”‚  â”‚  â”‚  â”‚ policy_integration.py      â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚  â”‚  â”‚  â€¢ can_do()                â”‚ â”‚
â”‚  â”‚  database.py              â”‚  â”‚  â”‚  â”‚  â€¢ get_allowed_record_ids()â”‚ â”‚
â”‚  â”‚    â€¢ DynamoDB connections â”‚  â”‚  â”‚  â”‚  â€¢ can_access_record()     â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚  â”‚  â”‚  â€¢ Wraps policy_engine.py  â”‚ â”‚
â”‚  â”‚  role_repository.py       â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚    â€¢ scan_all_roles()     â”‚  â”‚  â”‚                                  â”‚
â”‚  â”‚    â€¢ load_role_by_rid()   â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    â€¢ load_role_by_name()  â”‚  â”‚  â”‚  â”‚ policies.py                â”‚ â”‚
â”‚  â”‚    â€¢ batch_get_roles()    â”‚  â”‚  â”‚  â”‚  â€¢ normalize_policies()    â”‚ â”‚
â”‚  â”‚    â€¢ role_exists()        â”‚  â”‚  â”‚  â”‚  â€¢ deep_merge_policies()   â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚  â”‚  â”‚  â€¢ has_any_allow()         â”‚ â”‚
â”‚  â”‚  assignment_repository.py â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚    â€¢ load_user_assignmentsâ”‚  â”‚  â”‚                                  â”‚
â”‚  â”‚    â€¢ list_users_by_role() â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    â€¢ validate_target_user â”‚  â”‚  â”‚  â”‚ overrides.py               â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚  â”‚  â”‚  â€¢ get_user_overrides()    â”‚ â”‚
â”‚  â”‚  employee_repository.py   â”‚  â”‚  â”‚  â”‚  â€¢ process_override()      â”‚ â”‚
â”‚  â”‚    â€¢ get_employee_name()  â”‚  â”‚  â”‚  â”‚  â€¢ generate_ovid()         â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚  sequence_repository.py   â”‚  â”‚  â”‚                                  â”‚
â”‚  â”‚    â€¢ update_sequence()    â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    â€¢ get_display_id()     â”‚  â”‚  â”‚  â”‚ formatting.py              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â€¢ json_clean()            â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â€¢ format_role_metadata()  â”‚ â”‚
                                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           UTILS LAYER                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ utils/                                                            â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  response_utils.py    â†’ build_response(), get_cors_headers()     â”‚  â”‚
â”‚  â”‚  validation_utils.py  â†’ is_valid_user_id()                       â”‚  â”‚
â”‚  â”‚  time_utils.py        â†’ now_iso()                                â”‚  â”‚
â”‚  â”‚  token_utils.py       â†’ encode_token(), decode_token()           â”‚  â”‚
â”‚  â”‚  json_utils.py        â†’ json_clean() for Decimal/sets            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXTERNAL DEPENDENCIES                               â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DynamoDB      â”‚  â”‚ Policy Engine   â”‚  â”‚  Configuration       â”‚   â”‚
â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚                      â”‚   â”‚
â”‚  â”‚  â€¢ Roles Table â”‚  â”‚ policy_engine.pyâ”‚  â”‚  â€¢ config.py         â”‚   â”‚
â”‚  â”‚  â€¢ Grants Tableâ”‚  â”‚  (UNCHANGED)    â”‚  â”‚  â€¢ logging_config.py â”‚   â”‚
â”‚  â”‚  â€¢ Sequences   â”‚  â”‚                 â”‚  â”‚  â€¢ Environment vars  â”‚   â”‚
â”‚  â”‚  â€¢ Employees   â”‚  â”‚  â€¢ evaluate()   â”‚  â”‚                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â€¢ can_do()     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                      â”‚  â€¢ Rules engine â”‚                              â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DATA FLOW EXAMPLE: GET /roles?rid=role-123

1. API Gateway â†’ Lambda (lambda_function.py)
2. lambda_handler() extracts method=GET, rid=role-123
3. Routes to handle_get_request()
4. Handler calls handle_specific_role_view_by_rid()
5. Service calls can_access_record() â†’ Policy Engine
6. Policy Engine evaluates permissions â†’ ALLOW
7. Service calls load_role_by_rid() â†’ Models
8. Models queries DynamoDB â†’ Returns role
9. Service calls format_role_metadata() â†’ Formatting
10. Service calls build_response() â†’ Utils
11. Returns formatted HTTP response

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

KEY PRINCIPLES APPLIED:

âœ… Single Responsibility    Each module has one clear purpose
âœ… Separation of Concerns   Layers don't leak into each other
âœ… DRY (Don't Repeat)      No code duplication
âœ… Dependency Injection     Services receive dependencies
âœ… Interface Segregation    Clean package exports
âœ… Open/Closed Principle    Easy to extend, hard to break

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DEPLOYMENT PACKAGE:

Required Files:
âœ… lambda_function.py
âœ… handlers/ (all files)
âœ… services/ (all files)
âœ… models/ (all files)
âœ… utils/ (all files)
âœ… policy_engine.py (unchanged)
âœ… policy_integration.py
âœ… policies.py
âœ… overrides.py
âœ… formatting.py
âœ… config.py
âœ… logging_config.py
âœ… __init__.py

Documentation (optional):
ğŸ“„ docs/OVERVIEW.md
ğŸ“„ REFACTORING_SUMMARY.md
ğŸ“„ QUICK_REFERENCE.md
ğŸ“„ ARCHITECTURE.md (this file)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```
